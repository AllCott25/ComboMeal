<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Culinary Logic Puzzle - Easy Playtest</title>
    
    <style>
        /* Playtest selector styles */
        .playtest-selector {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #F5F1E8;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        .playtest-container {
            background-color: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .playtest-title {
            font-size: 28px;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
        }
        
        .playtest-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
        }
        
        .playtest-select {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            background-color: white;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        
        .playtest-select:hover {
            border-color: #778F5D;
        }
        
        .playtest-select:focus {
            outline: none;
            border-color: #778F5D;
            box-shadow: 0 0 0 3px rgba(119, 143, 93, 0.1);
        }
        
        .playtest-button {
            width: 100%;
            padding: 14px 24px;
            background-color: #778F5D;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        
        .playtest-button:hover {
            background-color: #66804f;
            transform: translateY(-1px);
        }
        
        .playtest-button:active {
            transform: translateY(0);
        }
        
        .playtest-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .playtest-error {
            color: #d32f2f;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .playtest-loading {
            color: #666;
            margin-top: 15px;
            font-size: 14px;
        }
        
        /* Hide the selector when game starts */
        .playtest-hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Playtest Date Selector -->
    <div id="playtestSelector" class="playtest-selector">
        <div class="playtest-container">
            <h1 class="playtest-title">Easy Playtest Mode</h1>
            <p class="playtest-subtitle">Select a recipe date to load the game</p>
            
            <select id="recipeSelect" class="playtest-select">
                <option value="">Loading recipes...</option>
            </select>
            
            <button id="loadRecipeBtn" class="playtest-button" disabled>
                Load Recipe
            </button>
            
            <div id="playtestMessage" class="playtest-loading" style="display: none;"></div>
            <div id="playtestError" class="playtest-error" style="display: none;"></div>
        </div>
    </div>
    
    <!-- Load all the game scripts in the same order as index.html -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- P5.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
    
    <!-- Easy Playtest Script (must load before other game scripts) -->
    <script>
        console.log("[EasyPlaytest] Script loaded");
        
        // Track if we're in easy playtest mode
        window.easyPlaytestActive = true;
        window.easyPlaytestSelectedDate = null;
        
        // Store original functions
        let originalFetchTodayRecipe = null;
        let originalCheckTodayCompletion = null;
        let originalLoadRecipeData = null;
        let originalProceedWithNormalFlow = null;
        let originalInitializeGame = null;
        let gameInitialized = false;
        
        // Override wallpaper loading to avoid CORS issues
        window.skipWallpaperAnimation = true;
        
        // Override getCurrentDateEST to return selected date
        window.getCurrentDateEST = function() {
            if (window.easyPlaytestSelectedDate) {
                return window.easyPlaytestSelectedDate;
            }
            // Default implementation
            const now = new Date();
            const offset = -5; // EST offset
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const estDate = new Date(utc + (3600000 * offset));
            
            const year = estDate.getFullYear();
            const month = String(estDate.getMonth() + 1).padStart(2, '0');
            const day = String(estDate.getDate()).padStart(2, '0');
            
            return `${year}-${month}-${day}`;
        };
        
        // Override loadImage to handle CORS issues
        if (typeof window.loadImage === 'undefined') {
            window.loadImage = function(path, successCallback, errorCallback) {
                const img = new Image();
                img.crossOrigin = 'anonymous'; // Set CORS mode
                
                img.onload = function() {
                    if (successCallback) successCallback(img);
                };
                
                img.onerror = function() {
                    if (errorCallback) errorCallback();
                };
                
                img.src = path;
                return img;
            };
        }
        
        // Function to load recipe list from Supabase
        async function loadRecipeList() {
            try {
                // Initialize Supabase if not already done
                if (!window.supabase) {
                    console.error('Supabase not initialized');
                    document.getElementById('playtestError').textContent = 'Error: Supabase not initialized';
                    document.getElementById('playtestError').style.display = 'block';
                    return;
                }
                
                // Fetch all recipes
                const { data: recipes, error } = await supabase
                    .from('recipes')
                    .select('*')
                    .order('date', { ascending: false });
                
                if (error) {
                    console.error('Error fetching recipes:', error);
                    document.getElementById('playtestError').textContent = 'Error: ' + error.message;
                    document.getElementById('playtestError').style.display = 'block';
                    return;
                }
                
                // Populate the dropdown
                const select = document.getElementById('recipeSelect');
                select.innerHTML = '<option value="">Choose a recipe...</option>';
                
                recipes.forEach(recipe => {
                    const option = document.createElement('option');
                    option.value = recipe.date;
                    option.textContent = `${recipe.date} - Day ${recipe.day_number}: ${recipe.name}`;
                    select.appendChild(option);
                });
                
                console.log(`Loaded ${recipes.length} recipes`);
                
            } catch (error) {
                console.error('Error loading recipes:', error);
                document.getElementById('playtestError').textContent = 'Error: ' + error.message;
                document.getElementById('playtestError').style.display = 'block';
            }
        }
        
        // Start game with selected recipe
        async function startWithSelectedRecipe() {
            const selectedDate = document.getElementById('recipeSelect').value;
            if (!selectedDate) {
                alert('Please select a recipe first');
                return;
            }
            
            console.log("[EasyPlaytest] Starting with date:", selectedDate);
            
            // Disable the button to prevent multiple clicks
            document.getElementById('loadRecipeBtn').disabled = true;
            
            // Show loading message
            document.getElementById('playtestMessage').textContent = 'Loading recipe...';
            document.getElementById('playtestMessage').style.display = 'block';
            document.getElementById('playtestError').style.display = 'none';
            
            try {
                // Set the selected date
                window.easyPlaytestSelectedDate = selectedDate;
                
                // Ensure recipe data is loaded
                const recipe = await window.fetchRecipeByDate(selectedDate);
                if (!recipe) {
                    throw new Error('Could not load recipe for selected date');
                }
                
                // Set the recipe data globally
                window.recipeData = recipe;
                
                // Update message
                document.getElementById('playtestMessage').textContent = 'Starting game...';
                
                // Reset game state
                window.gameStarted = false;
                window.gameWon = false;
                window.isLoadingRecipe = false;
                
                // Hide the selector
                document.getElementById('playtestSelector').classList.add('playtest-hidden');
                
                // Now start the game properly
                console.log("[EasyPlaytest] Starting game with selected date:", selectedDate);
                
                // Wait for p5.js to be ready before calling setup
                if (window.p5) {
                    // Remove any existing p5 instance
                    if (window.p5Instance) {
                        window.p5Instance.remove();
                        window.p5Instance = null;
                    }
                    
                    // Create new p5 instance with proper initialization
                    window.p5Instance = new p5(function(p) {
                        // DO NOT reassign window.p5 to avoid duplicate import warning
                        // window.p5 = p;
                        
                        // Get canvas reference
                        let canvas = null;
                        
                        // Define p5 functions globally
                        const p5Functions = [
                            'createCanvas', 'background', 'fill', 'stroke', 'strokeWeight',
                            'rect', 'ellipse', 'line', 'text', 'textSize', 'textAlign',
                            'push', 'pop', 'translate', 'rotate', 'scale', 'loadImage',
                            'image', 'tint', 'noTint', 'mouseX', 'mouseY', 'width', 'height',
                            'windowWidth', 'windowHeight', 'frameRate', 'frameCount',
                            'loadFont', 'textFont', 'color', 'red', 'green', 'blue',
                            'alpha', 'lerpColor', 'map', 'constrain', 'dist', 'atan2',
                            'cos', 'sin', 'PI', 'TWO_PI', 'HALF_PI', 'radians', 'degrees',
                            'random', 'noise', 'noiseSeed', 'randomSeed', 'floor', 'ceil',
                            'round', 'abs', 'sqrt', 'pow', 'exp', 'log', 'sq',
                            'CENTER', 'LEFT', 'RIGHT', 'TOP', 'BOTTOM', 'BASELINE',
                            'mousePressed', 'mouseReleased', 'keyPressed', 'keyReleased',
                            'noStroke', 'noFill', 'smooth', 'noSmooth', 'cursor', 'noCursor',
                            'beginShape', 'endShape', 'vertex', 'curveVertex', 'bezierVertex',
                            'CLOSE', 'BLEND', 'ADD', 'DARKEST', 'LIGHTEST', 'DIFFERENCE',
                            'EXCLUSION', 'MULTIPLY', 'SCREEN', 'REPLACE', 'OVERLAY',
                            'HARD_LIGHT', 'SOFT_LIGHT', 'DODGE', 'BURN', 'blendMode',
                            'angleMode', 'RADIANS', 'DEGREES', 'textWidth', 'textAscent',
                            'textDescent', 'loadSound', 'soundFormats', 'millis', 'resizeCanvas',
                            'filter', 'BLUR', 'GRAY', 'THRESHOLD', 'INVERT', 'POSTERIZE',
                            'DILATE', 'ERODE', 'pixelDensity', 'displayDensity', 'getURL',
                            'getURLPath', 'getURLParams', 'preload', 'setup', 'draw',
                            'remove', 'createGraphics', 'createVector', 'createStringDict',
                            'createNumberDict', 'select', 'selectAll', 'removeElements',
                            'createDiv', 'createP', 'createSpan', 'createImg', 'createA',
                            'createSlider', 'createButton', 'createCheckbox', 'createSelect',
                            'createRadio', 'createInput', 'createFileInput', 'createVideo',
                            'createAudio', 'createCapture', 'createElement', 'quad',
                            'triangle', 'arc', 'point', 'bezier', 'curve', 'clear',
                            'colorMode', 'RGB', 'HSB', 'HSL', 'hue', 'saturation', 'brightness',
                            'lightness', 'min', 'max', 'norm', 'lerp', 'mag', 'heading',
                            'createWriter', 'save', 'saveCanvas', 'saveFrames', 'httpGet',
                            'httpPost', 'httpDo', 'loadJSON', 'loadStrings', 'loadXML',
                            'loadBytes', 'loadTable', 'parseXML', 'parseJSONObject', 'parseJSONArray',
                            'day', 'hour', 'minute', 'second', 'year', 'month', 'pmouseX',
                            'pmouseY', 'winMouseX', 'winMouseY', 'pwinMouseX', 'pwinMouseY',
                            'touches', 'touchStarted', 'touchMoved', 'touchEnded', 'deviceMoved',
                            'deviceTurned', 'deviceShaken', 'keyIsPressed', 'key', 'keyCode',
                            'keyIsDown', 'keyTyped', 'mouseButton', 'mouseIsPressed',
                            'mouseMoved', 'mouseDragged', 'mouseClicked', 'mouseWheel',
                            'requestPointerLock', 'exitPointerLock', 'textStyle', 'NORMAL',
                            'ITALIC', 'BOLD', 'BOLDITALIC', 'textLeading', 'textWrap',
                            'WORD', 'CHAR', 'redraw', 'loop', 'noLoop', 'isLooping',
                            'popMatrix', 'pushMatrix', 'applyMatrix', 'resetMatrix',
                            'rotateX', 'rotateY', 'rotateZ', 'shearX', 'shearY', 'bezierPoint',
                            'bezierTangent', 'curvePoint', 'curveTangent', 'curveTightness',
                            'rectMode', 'CORNER', 'CORNERS', 'RADIUS', 'ellipseMode',
                            'imageMode', 'loadShader', 'resetShader', 'shader', 'normalMaterial',
                            'texture', 'ambientMaterial', 'specularMaterial', 'shininess',
                            'camera', 'perspective', 'ortho', 'frustum', 'createCamera',
                            'setCamera', 'ambientLight', 'directionalLight', 'pointLight',
                            'spotLight', 'lights', 'lightFalloff', 'loadModel', 'model',
                            'plane', 'box', 'sphere', 'cylinder', 'cone', 'torus', 'orbitControl',
                            'debugMode', 'noDebugMode', 'setAttributes', 'createShader',
                            'createFilterShader', 'setUniform'
                        ];
                        
                        // Expose p5 functions globally
                        p5Functions.forEach(fn => {
                            if (typeof p[fn] !== 'undefined') {
                                if (fn === 'textFont') {
                                    // Special handling for textFont to avoid null font error
                                    window[fn] = function(font) {
                                        if (font) {
                                            return p[fn].apply(p, arguments);
                                        }
                                        // If font is null/undefined, don't call p5's textFont
                                    };
                                } else {
                                    window[fn] = function() {
                                        return p[fn].apply(p, arguments);
                                    };
                                }
                            }
                        });
                        
                        // Expose p5 constants globally
                        const p5Constants = [
                            'PI', 'TWO_PI', 'HALF_PI', 'QUARTER_PI', 'TAU',
                            'DEGREES', 'RADIANS',
                            'CORNER', 'CORNERS', 'RADIUS', 'RIGHT', 'LEFT', 'CENTER', 'TOP', 'BOTTOM',
                            'BASELINE', 'POINTS', 'LINES', 'LINE_STRIP', 'LINE_LOOP', 'TRIANGLES',
                            'TRIANGLE_FAN', 'TRIANGLE_STRIP', 'QUADS', 'QUAD_STRIP', 'CLOSE',
                            'OPEN', 'CHORD', 'PIE', 'PROJECT', 'SQUARE', 'ROUND', 'BEVEL', 'MITER',
                            'RGB', 'HSB', 'HSL', 'AUTO', 'ALT', 'BACKSPACE', 'CONTROL', 'DELETE',
                            'DOWN_ARROW', 'ENTER', 'ESCAPE', 'LEFT_ARROW', 'OPTION', 'RETURN',
                            'RIGHT_ARROW', 'SHIFT', 'TAB', 'UP_ARROW', 'BLEND', 'REMOVE', 'ADD',
                            'DARKEST', 'LIGHTEST', 'DIFFERENCE', 'EXCLUSION', 'MULTIPLY', 'SCREEN',
                            'REPLACE', 'OVERLAY', 'HARD_LIGHT', 'SOFT_LIGHT', 'DODGE', 'BURN',
                            'THRESHOLD', 'GRAY', 'OPAQUE', 'INVERT', 'POSTERIZE', 'DILATE', 'ERODE',
                            'BLUR', 'NORMAL', 'ITALIC', 'BOLD', 'BOLDITALIC',
                            'LANDSCAPE', 'PORTRAIT', 'GRID', 'AXES', 'ARROW', 'CROSS', 'HAND',
                            'MOVE', 'TEXT', 'WAIT', 'HALF_FLOAT', 'RGBA', 'FLOAT', 'DOUBLE',
                            'INT', 'LONG', 'TESS', 'WORD', 'CHAR'
                        ];
                        
                        p5Constants.forEach(constant => {
                            if (typeof p[constant] !== 'undefined') {
                                window[constant] = p[constant];
                            }
                        });
                        
                        // Also expose p5 properties
                        Object.defineProperty(window, 'width', {
                            get: () => p.width,
                            configurable: true
                        });
                        Object.defineProperty(window, 'height', {
                            get: () => p.height,
                            configurable: true
                        });
                        Object.defineProperty(window, 'mouseX', {
                            get: () => p.mouseX,
                            configurable: true
                        });
                        Object.defineProperty(window, 'mouseY', {
                            get: () => p.mouseY,
                            configurable: true
                        });
                        Object.defineProperty(window, 'pmouseX', {
                            get: () => p.pmouseX,
                            configurable: true
                        });
                        Object.defineProperty(window, 'pmouseY', {
                            get: () => p.pmouseY,
                            configurable: true
                        });
                        Object.defineProperty(window, 'windowWidth', {
                            get: () => p.windowWidth,
                            configurable: true
                        });
                        Object.defineProperty(window, 'windowHeight', {
                            get: () => p.windowHeight,
                            configurable: true
                        });
                        Object.defineProperty(window, 'frameCount', {
                            get: () => p.frameCount,
                            configurable: true
                        });
                        Object.defineProperty(window, 'deltaTime', {
                            get: () => p.deltaTime,
                            configurable: true
                        });
                        Object.defineProperty(window, 'focused', {
                            get: () => p.focused,
                            configurable: true
                        });
                        Object.defineProperty(window, 'displayWidth', {
                            get: () => p.displayWidth,
                            configurable: true
                        });
                        Object.defineProperty(window, 'displayHeight', {
                            get: () => p.displayHeight,
                            configurable: true
                        });
                        Object.defineProperty(window, 'key', {
                            get: () => p.key,
                            configurable: true
                        });
                        Object.defineProperty(window, 'keyCode', {
                            get: () => p.keyCode,
                            configurable: true
                        });
                        Object.defineProperty(window, 'keyIsPressed', {
                            get: () => p.keyIsPressed,
                            configurable: true
                        });
                        Object.defineProperty(window, 'mouseIsPressed', {
                            get: () => p.mouseIsPressed,
                            configurable: true
                        });
                        Object.defineProperty(window, 'mouseButton', {
                            get: () => p.mouseButton,
                            configurable: true
                        });
                        Object.defineProperty(window, 'touches', {
                            get: () => p.touches,
                            configurable: true
                        });
                        
                        // Set up p5 callbacks
                        p.preload = function() {
                            console.log("[EasyPlaytest] Running preload");
                            // Initialize fonts first as string values
                            window.titleFont = 'Courier, "Courier New", monospace';
                            window.bodyFont = 'Helvetica, Arial, sans-serif';
                            window.buttonFont = 'Helvetica, Arial, sans-serif';
                            
                            // Initialize color palette
                            window.COLORS = {
                                background: '#f8f5f2',    
                                primary: '#9a9832',       
                                secondary: '#cf6d88',     
                                tertiary: '#FFFFFF',      
                                accent: '#7A9BB5',        
                                text: '#333333',          
                                vesselBase: '#F9F5EB',    
                                vesselYellow: '#FFFFFF',  
                                vesselGreen: '#9a9832',   
                                vesselHint: '#f7dc30',    
                                green: '#9a9832',         
                                peach: '#da9356',          
                                HintPink: '#cf6d88' 
                            };
                            
                            window.COMPLETED_VESSEL_COLORS = [
                                '#f3a9b2', // Light pink
                                '#cfc23f', // Mustard yellow
                                '#f7dc30', // Bright yellow
                                '#cf6d88', // Pink
                                '#dd9866'  // Peach/orange
                            ];
                            
                            if (window.originalPreload) {
                                window.originalPreload();
                            } else if (window.preload) {
                                window.preload();
                            }
                        };
                        
                        p.setup = function() {
                            console.log("[EasyPlaytest] Running setup");
                            
                            // Initialize game state variables if needed
                            if (typeof window.gameStarted === 'undefined') {
                                window.gameStarted = false;
                            }
                            if (typeof window.gameWon === 'undefined') {
                                window.gameWon = false;
                            }
                            if (typeof window.isLoadingRecipe === 'undefined') {
                                window.isLoadingRecipe = false;
                            }
                            if (typeof window.loadingComplete === 'undefined') {
                                window.loadingComplete = true;
                            }
                            if (typeof window.wallpaperImageReady === 'undefined') {
                                window.wallpaperImageReady = false;
                            }
                            if (typeof window.skipWallpaperAnimation === 'undefined') {
                                window.skipWallpaperAnimation = true;
                            }
                            
                            // Override createCanvas to capture the canvas reference
                            const originalCreateCanvas = p.createCanvas;
                            p.createCanvas = function() {
                                canvas = originalCreateCanvas.apply(p, arguments);
                                window.canvas = canvas;
                                return canvas;
                            };
                            window.createCanvas = p.createCanvas;
                            
                            if (window.originalSetup) {
                                window.originalSetup();
                            } else if (window.setup) {
                                window.setup();
                            }
                        };
                        
                        p.draw = function() {
                            if (window.draw) {
                                window.draw();
                            }
                        };
                        
                        p.mousePressed = function() {
                            if (window.mousePressed) {
                                return window.mousePressed();
                            }
                        };
                        
                        p.mouseReleased = function() {
                            if (window.mouseReleased) {
                                return window.mouseReleased();
                            }
                        };
                        
                        p.keyPressed = function() {
                            if (window.keyPressed) {
                                return window.keyPressed();
                            }
                        };
                        
                        p.windowResized = function() {
                            if (window.windowResized) {
                                return window.windowResized();
                            }
                        };
                    });
                } else {
                    throw new Error('p5.js library not loaded');
                }
                
            } catch (error) {
                console.error('Error starting game:', error);
                document.getElementById('playtestError').textContent = 'Error: ' + error.message;
                document.getElementById('playtestError').style.display = 'block';
                document.getElementById('playtestMessage').style.display = 'none';
                document.getElementById('loadRecipeBtn').disabled = false;
            }
        }
        
        // Set up event listeners when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Enable the load button when a recipe is selected
            document.getElementById('recipeSelect').addEventListener('change', function() {
                const hasSelection = this.value !== '';
                document.getElementById('loadRecipeBtn').disabled = !hasSelection;
                if (hasSelection) {
                    document.getElementById('playtestError').style.display = 'none';
                }
            });
            
            // Handle load button click
            document.getElementById('loadRecipeBtn').addEventListener('click', startWithSelectedRecipe);
            
            // Start loading recipes after a short delay to ensure scripts are loaded
            setTimeout(loadRecipeList, 1000);
        });
    </script>
    
    <!-- Configuration - loads environment-specific settings -->
    <script src="js/config.js"></script>
    <!-- Design System - must load before other game scripts -->
    <script src="js/design-system.js"></script>
    <!-- Our Supabase Integration -->
    <script src="js/supabase.js"></script>
    <!-- Streak System -->
    <script src="js/streak.js"></script>
    <!-- User Migration System -->
    <script src="js/user-migration.js"></script>
    <!-- VesselSystem Module - Load before main game script -->
    <script src="js/modules/VesselSystem.js"></script>
    <!-- Animation  Script -->
    <script src="js/animation.js"></script>
    <!-- Interaction Script -->
    <script src="js/interaction.js"></script>
    <!-- Menu System -->
    <script src="js/menu.js"></script>
    <!-- Authentication Modal -->
    <script src="js/auth-modal.js"></script>
    <!-- Main Game Script -->
    <script src="js/sketch.js"></script>
    <!-- GameLogic Script -->
    <script src="js/GameLogic.js"></script>
    <!-- Draw Script -->
    <script src="js/draw.js"></script>
    <!-- WinScreen Script -->
    <script src="js/WinScreen.js"></script>
    <!-- Egg Script -->
    <script src="js/egg.js"></script>
    <!-- Help Modal Script -->
    <script src="js/help.js"></script>
    
    <!-- Capture original functions after all scripts load -->
    <script>
        // Prevent p5.js from auto-starting
        window._setupDone = true;
        window._preloadDone = true;
        
        // Override setup immediately to prevent auto-start
        window.originalSetup = null;
        
        // Wait for all scripts to load
        window.addEventListener('load', function() {
            console.log("[EasyPlaytest] All scripts loaded, capturing original functions");
            
            // Override wallpaper loading to prevent CORS issues
            if (window.preload) {
                const originalPreload = window.preload;
                window.preload = function() {
                    console.log("[EasyPlaytest] Modified preload - skipping wallpaper animation");
                    
                    // Set flags to skip wallpaper loading
                    window.wallpaperImageReady = false;
                    window.loadingComplete = true;
                    window.skipWallpaperAnimation = true;
                    
                    // Still need to set up colors and fonts
                    // These will be set in the original preload or setup
                };
            }
            
            // Capture setup before p5.js overwrites it
            if (window.setup && !window.originalSetup) {
                window.originalSetup = window.setup;
                window.setup = function() {
                    if (window.easyPlaytestActive && !window.easyPlaytestSelectedDate) {
                        console.log("[EasyPlaytest] Preventing setup until date is selected");
                        return;
                    }
                    if (window.originalSetup) {
                        window.originalSetup();
                    }
                };
            }
            
            // Prevent any existing p5 instance from running
            if (window.p5 && window.p5.instance) {
                window.p5.instance = null;
            }
        });
    </script>
</body>
</html>